import"./index-DmKw4XXH.js";import{M as oe,D as ne,c as ie,u as de,a as ue,C as re,T as ce,S as A,d as me,t as _e,b as fe}from"./TaskDetailDialog-EJ733YdM.js";import{P as pe,E as ve,I as B,f as $,S as j}from"./el-card-gthh8NLS.js";/* empty css                  */import{s as b,w as G,C as k,a as r,f as l,h as o,b as e,j as a,a9 as ge,aa as ke,ab as Q,S as i,a6 as X,ac as be,ad as Ce,ae as we,af as q,v as ye,ag as H,c as M,ah as Y,F as he,x as ze,q as K,G as x,ai as Ve,aj as Te,ak as Ee,A as O,al as I,am as W,an as De,ao as Se,ap as $e,aq as Me,ar as xe,as as Ie,at as Pe,au as Ae,av as Be,aw as Ne,ax as Ue,ay as Le,az as Re,aA as Fe,aB as je,H as Ge,aC as qe,aD as He,aE as Ye}from"./element-plus-D2VUXABr.js";import{_ as Z,T as J,b as Ke,a as Oe}from"./_plugin-vue_export-helper-ySprrkWw.js";import"./codemirror-CauJjIGm.js";import"./vue-flow-DmkpiIJk.js";const We={class:"dialog-body"},Je={__name:"TaskFormDialog",props:{modelValue:Boolean},emits:["update:modelValue","success"],setup(N,{emit:C}){const w=N,p=C,_=b(!1),y=b(null),v=b(!1),d=b(`# 任务名称, 可选, 默认自动生成
name: 测试任务
${J}`);G(()=>w.modelValue,c=>{_.value=c}),G(_,c=>{p("update:modelValue",c),c||h()});const U=async()=>{const c=d.value.trim();if(!c){q.warning("请输入配置内容");return}v.value=!0;try{const n=await ie(c);q.success("任务创建成功"),p("success",n.data.name),h()}catch{}finally{v.value=!1}},h=()=>{_.value=!1,d.value=`# 任务名称, 可选, 默认自动生成
name: 测试任务
${J}`};return(c,n)=>{const z=X,g=Q,V=we;return r(),k(V,{modelValue:_.value,"onUpdate:modelValue":n[1]||(n[1]=D=>_.value=D),"close-on-click-modal":!1,"show-close":!1,onClose:h,fullscreen:"",class:"form-dialog"},{header:l(()=>[e(a(ne),{icon:a(ke),title:"创建新任务","show-close":!1},{actions:l(()=>[e(g,{size:"default",onClick:h},{default:l(()=>[e(z,null,{default:l(()=>[e(a(be))]),_:1}),n[2]||(n[2]=i(" 取消 ",-1))]),_:1}),e(g,{type:"primary",size:"default",onClick:U,loading:v.value},{default:l(()=>[e(z,null,{default:l(()=>[e(a(Ce))]),_:1}),n[3]||(n[3]=i(" 创建任务 ",-1))]),_:1},8,["loading"])]),_:1},8,["icon"])]),default:l(()=>[o("div",We,[e(a(oe),{ref_key:"editorRef",ref:y,modelValue:d.value,"onUpdate:modelValue":n[0]||(n[0]=D=>d.value=D),language:"yaml",theme:"vs-dark",title:"YAML 配置编辑器","toolbar-icon":a(ge),height:"100%"},null,8,["modelValue","toolbar-icon"])])]),_:1},8,["modelValue"])}}},Qe=Z(Je,[["__scopeId","data-v-8b3cba70"]]),Xe={class:"page-toolbar"},Ze={class:"toolbar-left"},ea={class:"toolbar-right"},aa={class:"stats-grid"},la={key:0},ta=["onClick"],sa={class:"card-header"},oa={class:"task-name"},na={class:"card-body"},ia={class:"task-meta"},da={class:"task-status-section"},ua={class:"action-buttons"},ra={key:1,class:"table-view"},ca={class:"task-name-cell"},ma={class:"name-text"},_a={class:"action-buttons"},fa={class:"pagination-wrapper"},pa={__name:"TaskManagement",setup(N){const{viewMode:C}=Ke("grid","task-view-mode"),w=b(!1),p=b(!1),_=b(""),{items:y,loading:v,pagination:d,refresh:U,changePage:h,changePageSize:c,connect:n}=de(Oe.task),{stats:z}=ue(y),g=T=>{_.value=T.name,p.value=!0},V=async(T,s)=>{switch(T){case"detail":g(s);break;case"dump":await fe(s.name);break;case"kill":await _e(s.name,"kill");break;case"delete":await me(s.name);break}},D=T=>{_.value=T,p.value=!0};return ye(()=>{n()}),(T,s)=>{const m=X,f=Q,L=qe,ee=je,E=Ie,P=Ne,ae=Be,le=Pe,te=xe,se=Ue,R=Me;return r(),k(a(pe),null,{toolbar:l(()=>[o("div",Xe,[o("div",Ze,[e(f,{type:"primary",onClick:s[0]||(s[0]=t=>w.value=!0),size:"large"},{default:l(()=>[e(m,null,{default:l(()=>[e(a(Y))]),_:1}),s[7]||(s[7]=i(" 新建任务 ",-1))]),_:1})]),o("div",ea,[e(ee,{modelValue:a(C),"onUpdate:modelValue":s[1]||(s[1]=t=>Ge(C)?C.value=t:null),size:"default"},{default:l(()=>[e(L,{value:"grid"},{default:l(()=>[e(m,null,{default:l(()=>[e(a(He))]),_:1}),s[8]||(s[8]=i(" 卡片 ",-1))]),_:1}),e(L,{value:"table"},{default:l(()=>[e(m,null,{default:l(()=>[e(a(Ye))]),_:1}),s[9]||(s[9]=i(" 列表 ",-1))]),_:1})]),_:1},8,["modelValue"])])])]),stats:l(()=>[o("div",aa,[e(a(A),{icon:a(Le),label:"运行中",value:a(z).running,variant:"running",clickable:""},null,8,["icon","value"]),e(a(A),{icon:a(Re),label:"已完成",value:a(z).stopped,variant:"success",clickable:""},null,8,["icon","value"]),e(a(A),{icon:a(Fe),label:"已失败",value:a(z).failed,variant:"failed",clickable:""},null,8,["icon","value"])])]),footer:l(()=>[o("div",fa,[e(se,{"current-page":a(d).current,"onUpdate:currentPage":s[3]||(s[3]=t=>a(d).current=t),"page-size":a(d).size,"onUpdate:pageSize":s[4]||(s[4]=t=>a(d).size=t),"page-sizes":[15,30,45,60],total:a(d).total*a(d).size,background:!0,layout:"sizes, prev, pager, next, jumper",onSizeChange:a(c),onCurrentChange:a(h)},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])])]),default:l(()=>[a(C)==="grid"?H((r(),M("div",la,[a(y).length===0&&!a(v)?(r(),k(a(ve),{key:0,description:"暂无任务"},{actions:l(()=>[e(f,{type:"primary",onClick:s[2]||(s[2]=t=>w.value=!0)},{default:l(()=>[e(m,null,{default:l(()=>[e(a(Y))]),_:1}),s[10]||(s[10]=i(" 创建第一个任务 ",-1))]),_:1})]),_:1})):(r(),k(a(re),{key:1,"min-column-width":340},{default:l(()=>[(r(!0),M(he,null,ze(a(y),t=>{var u,F;return r(),M("div",{key:t.name,class:"task-card",onClick:S=>g(t)},[o("div",sa,[o("div",{class:K(["task-status-indicator",`status-${t.state}`])},null,2),o("h3",oa,x(t.name),1)]),o("div",na,[o("div",ia,[e(a(B),{icon:a(Ve),label:"步骤数",value:t.count,layout:"horizontal",hoverable:""},null,8,["icon","value"]),e(a(B),{icon:a(Te),label:"开始时间",value:a($)((u=t.time)==null?void 0:u.start),"value-class":"time",layout:"horizontal",hoverable:""},null,8,["icon","value"]),e(a(B),{icon:a(Ee),label:"结束时间",value:a($)((F=t.time)==null?void 0:F.end),"value-class":"time",layout:"horizontal",hoverable:""},null,8,["icon","value"])]),o("div",da,[e(a(j),{status:t.state,size:"large",effect:"plain","show-icon":""},null,8,["status"]),o("div",ua,[e(f,{size:"small",onClick:I(S=>g(t),["stop"])},{default:l(()=>[e(m,null,{default:l(()=>[e(a(W))]),_:1})]),_:1},8,["onClick"]),e(f,{size:"small",onClick:I(S=>V("dump",t),["stop"])},{default:l(()=>[e(m,null,{default:l(()=>[e(a(De))]),_:1})]),_:1},8,["onClick"]),t.state==="running"?(r(),k(f,{key:0,size:"small",type:"warning",onClick:I(S=>V("kill",t),["stop"])},{default:l(()=>[e(m,null,{default:l(()=>[e(a(Se))]),_:1})]),_:1},8,["onClick"])):O("",!0),e(f,{size:"small",type:"danger",onClick:I(S=>V("delete",t),["stop"])},{default:l(()=>[e(m,null,{default:l(()=>[e(a($e))]),_:1})]),_:1},8,["onClick"])])])])],8,ta)}),128))]),_:1}))])),[[R,a(v)]]):(r(),M("div",ra,[H((r(),k(te,{data:a(y),stripe:"",class:"modern-table"},{default:l(()=>[e(E,{prop:"name",label:"任务名称","min-width":"200",fixed:""},{default:l(({row:t})=>[o("div",ca,[o("div",{class:K(["status-dot",`status-${t.state}`])},null,2),o("span",ma,x(t.name),1)])]),_:1}),e(E,{prop:"count",label:"步骤数",width:"100",align:"center"}),e(E,{label:"开始时间","min-width":"180"},{default:l(({row:t})=>{var u;return[i(x(a($)((u=t.time)==null?void 0:u.start)),1)]}),_:1}),e(E,{label:"结束时间","min-width":"180"},{default:l(({row:t})=>{var u;return[i(x(a($)((u=t.time)==null?void 0:u.end)),1)]}),_:1}),e(E,{label:"执行状态",width:"140",align:"center"},{default:l(({row:t})=>[e(a(j),{status:t.state,effect:"plain"},null,8,["status"])]),_:1}),e(E,{label:"操作",width:"240",fixed:"right"},{default:l(({row:t})=>[o("div",_a,[e(f,{size:"small",onClick:u=>g(t)},{default:l(()=>[e(m,null,{default:l(()=>[e(a(W))]),_:1}),s[11]||(s[11]=i(" 详情 ",-1))]),_:1},8,["onClick"]),e(le,{trigger:"click",onCommand:u=>V(u,t)},{dropdown:l(()=>[e(ae,null,{default:l(()=>[e(P,{command:"dump"},{default:l(()=>[...s[13]||(s[13]=[i("导出配置",-1)])]),_:1}),t.state==="running"?(r(),k(P,{key:0,command:"kill",divided:""},{default:l(()=>[...s[14]||(s[14]=[i(" 强制停止 ",-1)])]),_:1})):O("",!0),e(P,{command:"delete",divided:""},{default:l(()=>[...s[15]||(s[15]=[i("删除任务",-1)])]),_:1})]),_:2},1024)]),default:l(()=>[e(f,{size:"small"},{default:l(()=>[s[12]||(s[12]=i(" 更多",-1)),e(m,{class:"el-icon--right"},{default:l(()=>[e(a(Ae))]),_:1})]),_:1})]),_:2},1032,["onCommand"])])]),_:1})]),_:1},8,["data"])),[[R,a(v)]])])),e(Qe,{modelValue:w.value,"onUpdate:modelValue":s[5]||(s[5]=t=>w.value=t),onSuccess:D},null,8,["modelValue"]),e(ce,{modelValue:p.value,"onUpdate:modelValue":s[6]||(s[6]=t=>p.value=t),"task-name":_.value},null,8,["modelValue","task-name"])]),_:1})}}},za=Z(pa,[["__scopeId","data-v-49d63960"]]);export{za as default};
